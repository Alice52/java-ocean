## mysql 参数

1. innodb_buffer_pool_size: `物理内存 * 3/4`, cache table and index data.

2. [Innodb 缓冲池命中率计算](https://hdm.console.aliyun.com/dbMonitor/MySQL#/performance/instance/rm-2zefr83ok57101uxm/detail)

   ```sql
   show global status like 'innodb%read%';
   ```

   - Innodb_buffer_pool_reads: 表示从物理磁盘读取页的次数
   - Innodb_buffer_pool_read_ahead: 预读的次数
   - Innodb_buffer_pool_read_ahead_evicted: 预读的页, 但是没有读取就从缓冲池中被替换的页的数量, 一般用来判断预读的效率
   - Innodb_buffer_pool_read_requests: 从缓冲池中读取页的次数
   - Innodb_data_read: 总共读入的字节数
   - Innodb_data_reads: 发起读取请求的次数, 每次读取可能需要读取多个页

   - **Innodb 缓冲池命中率计算: (Innodb_buffer_pool_read_requests - Innodb_buffer_pool_reads) / Innodb_buffer_pool_read_requests**
   - InnoDB Buffer Pool 使用率: **innodb_buffer_pool_pages_data / (innodb_buffer_pool_pages_data + innodb_buffer_pool_pages_free)**

3. 强数据一致性相关参数设置

   - sync_binlog
   - innodb_flush_log_at_trx_commit

4. 性能相关: 组提交

   - binlog_group_commit_sync_delay: 表示延迟多少微秒后才调用 fsync`{如无需要则不要修改, 会导致一些简单操作也要等这么久才能发挥}`
   - binlog_group_commit_sync_no_delay_count: 累积多少次以后才调用 fsync
   - orderby/groupby: max_length_for_sort_data + sort_buffer_size
   - max_connections + wait_timeout+ interactive_timeout

5. lock

   - innodb_locks_unsafe_for_binlog: 默认为 0, 表示启用 gaplock, **主要解决幻读问题**{无关更新操作}

### Buffer Pool

![avatar](/static/image/db/mysql-conf-bp.png)

0. link

   - https://zhuanlan.zhihu.com/p/415004185
   - https://mp.weixin.qq.com/s?__biz=Mzg4NTcyNjczNg==&mid=2247504302&idx=1&sn=119d0819c3127b4194b6677dd90ca63b

1. 简介

   - 存放的是数据与索引: **索引并不是都在内存中**
   - 缓存页{16KB}: bp 数据的额基本单元 + `磁盘数据 按照数据页组织: 16KB`;
   - 描述数据{800byte}: 所属表空间, 数据页的编号, bp 中的地址
   - 相关的数据结构
     1. Free 链表{双向}: 存放空闲缓存页
     2. 缓存页哈希表: 快速定位缓存页{key(表空间号+数据页号)-value(缓存页地址)}
     3. Flush 链表: 存放脏页
     4. LRU 链表: 内存不够时淘汰方式 + 优化{数据冷热区分}
   - 预读机制: 调用存储引擎时将下次可能用到的数据和索引加载到 Buffer Pool

2. 配置:
   - 大小: `3/4 * MaxMemory`
   - 个数: `{LEAST(MaxMemory/1G, 8)}`
