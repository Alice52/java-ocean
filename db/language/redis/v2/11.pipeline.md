## Pipeline

1. 简介

   - 官方测试上性能优 10 倍的提升
   - 需要客户端 & 服务端的支持
   - 定义: 将一组命令进行**组装**, 通过一次 RTT 传输给 Redis, 同时再将这组命令的执行结果按照**顺序**返回给客户端
   - 核心: 减少网络传输(RTT) & IO 读写(内核态/用户态)
   - redis cluster 中使用 pipeline 时必须满足 pipeline 打包的所有命令 key 在同一个 slot 上; 如果打包命令的 key 不在同一个 slot 上, 就会报错

2. 客户端 & 服务端 支持

   - server: 能够处理客户端通过一个 TCP 连接发送的多个命令, 对多个命令进行排队/执行
   - client: 需要将多个命令缓存起来, 待缓冲区满了就发送, 同时还需要处理 Redis 的应答
     1. client 需要注意控制命令的大小: 否则会造成网络堵塞

3. pipeline vs 批量(_mset_) vs lua

   - pipeline 可以一次性发送多个不同的命令[set/get]; 而批量一次只能是一个命令[只不过这一次对应的是多个 key]
   - pipeline 只是将多个命令{不彼此依赖时}一起发出去而已, **不保证这些命令的执行是原子性**; 而批量则是原子性的[需要保证整个操作的正确性, 避免中途出错而导致最后产生的数据不一致]
   - lua: 可以保证原子性的执行多个不同的命令

![avatar](/static/image/db/redis-pipeline.png)
