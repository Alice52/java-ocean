## 服务配置

### 1. Config[deprecate]

1. Config

   - 为微服务提供集中式的的中心化的外部配置
   - 客户端
     - bootstrap.yml: 系统级的配置文件[优先级高]
     - application.yml: 用户级的配置文件
   - 服务端
     - application.yml: 用户级的配置文件

2. function

   - 集中管理配置文件
   - 不同环境不同配置, 动态化配置更新,
   - 运行期间动态调整
   - 当配置文件发生变化时, 服务不需要重启即可感知到配置的变化, 并应用新的变化
   - 将配置信息以 rest 接口形式暴露

3. file server

   - spring cloud config 默认使用 git 来存储配置信息

4. struct
   ![avatar](/static/image/spring/cloud-config.png)

5. config

   - server yml

   ```yml
   server:
     port: 3344

   spring:
     application:
       name: cloud-config-center-service
     cloud:
       config:
         server:
           git:
             # http://localhost:3344/[master]/dev-config.yml
             uri: https://gitee.com/alice52_xz/cloud-config.git
             search-paths:
               - tutorial-sample
         label: master

   eureka:
     client:
       fetch-registry: true
       register-with-eureka: true
       service-url:
         defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka
   ```

   - client config: pom diff

   ```yml
   # bootstap.yml
   server:
     port: 3355

   spring:
     application:
       name: cloud-config-client-service
     cloud:
       config:
         label: master
         name: config
         profile: dev
         uri: http://localhost:3344
         # http://localhost:3344/master/config-dev.yml

   eureka:
     client:
       register-with-eureka: true
       fetch-registry: true
       service-url:
         defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka
   ```

   - client 动态刷新

     1. pom

     ```xml
     <dependency>
       <groupId>org.springframework.boot</groupId>
         <artifactId>spring-boot-starter-actuator</artifactId>
     </dependency>
     ```

     2.yml add config

     ```yml
     management:
       endpoints:
         web:
           exposure:
             include: '*'
     ```

     3. controller add `@RefreshScope`.
     4. should can this api: `curl -X POST "http://localhost:3355/actuator/refresh"`

     5. issue
        - each time will change config in file server
        - each shoukd do api call, not actually auto refresh
        - how to do once notice, all or specify microsoft server upgrate config?? `BUS`

6. 读取配置文件的规则

   - **/{label}/{application}-{profile}.yml**: `http://localhost:3344/dev-config.yml`
   - /{application}-{profile}.yml: `http://localhost:3344/master/dev-config.yml`
   - /{application}/{profile}/{label}: `http://localhost:3344/dev-config/master`

### 2. Nacos[recommend]
