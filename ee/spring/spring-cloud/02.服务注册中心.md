## 服务注册中心

### 1. Eureka[deprecate]

1. 基础知识[C/S]

- 服务治理: **管理服务以及服务之间的关系**

  1. 在传统的 RPC 远程调用框架中, 管理每个服务和服务之间的依赖关系比较复杂, 所以需要使用 **服务治理**,
  2. _管理服务于服务之间的关系, 实现服务调用/负载均衡/容错等, 实现服务注册与发现_

- 服务注册: **将服务信息注册进注册中心**

  1. Eureka Server 实现 服务注册, 是服务注册中心[所有的 RPC 框架都会有一个注册中心]
  2. Eureka Client 连接到 Eureka Server, 并维持心跳
  3. diagram

  ![avatar](/static/image/spring/springcloud-eureka.jpg)

  4. 补充

     - 注册中心: 服务启动, 会把当前服务器信息[服务地址/通讯地址等]以别名方式注册到注册中心
     - Client[消费者/服务提供者]: 会以别名的方式去注册中心获取实际的通讯地址, 实现 RPC 调用
     - RPC 核心思想: 注册中心, 以为注册中心管理者每个服务以及服务之间依赖[**服务治理**]

- 服务发现: **从服务中心获取获取服务信息**

  - 本质上都是存储的 K-V 数据

- Eureka 的组件

  1. Eureka 是 C/S 架构, Server / Client
  2. Server: 提供注册服务

     - 各个服务节点配置启动后, 会在 Eureka Server 中注册
     - Eureka Server 会存储哦呦可用服务节点信息
     - 这些信息在 UI 上可以看到

  3. Client

     - Client will maintain Heartbeat with Server, default value is 30 second
     - Client has builtin balance loader implement with round-robin
     - If the Heartbeat stop for specify time, default 90 seconds, Server will remove it from register center

- step

  1. 启动 Eureka 注册中心
  2. 启动服务提供者, 将自身的信息注册[别名方式]到注册中心
  3. 启动消费提供者, 将自身的信息注册[别名方式]到注册中心
  4. 消费者服务在需要调用接口时, 使用 **`服务别名`** 去注册中心去获取实际的 RPC 调用地址
  5. 底层实际上是使用 HttpClient 技术实现远程调用
  6. 消费者在获取服务地址后会缓存到本地的 JVM 中, 默认 30 second 服务调用地址

2. 单机版构建

   - add maven dependency

   ```xml
   <!-- version control in dependencyManagement: boot -->
   <!-- eureka server -->
   <dependency>
       <groupId>org.springframework.cloud</groupId>
       <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
   </dependency>
   <!-- eureka server -->
   <dependency>
       <groupId>org.springframework.cloud</groupId>
       <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
   </dependency>
   ```

   - add @EnableEurekaClient / @EnableEurekaServer

   ```java
   @SpringBootApplication
   @EnableEurekaClient / @EnableEurekaServer
   public class PaymentApplication {
       public static void main(String[] args) {
           SpringApplication.run(PaymentApplication.class, args);
       }
   }
   ```

   - config application.yml

   ```yml
   # server
   eureka:
     instance:
       # eureka instance name
       hostname: localhost
     client:
       # false indicate itself donot register
       register-with-eureka: false
       # indicate itself is register center, it's duty is maintain service instances,
       # and donot retrieve register info from  server
       fetch-registry: false # indicates whether this client should fetch eureka registry information from eureka server.
       # set interaction URI, and query service address and resister is all dependence on this URI
       service-url:
         defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/

   # client
   eureka:
     client:
       register-with-eureka: true
       fetch-registry: true
       service-url:
       defaultZone: http://localhost:7001/eureka/
   ```

3. 集群构建: **`互相注册, 相互守望`**

4. actuator

5. 服务发现

6. eureka 的自我保护

### 2. Zookeeper

### 3. Consul

### 4. Nacos[recommend]
