## [简述 paxos 算法](https://www.bilibili.com/video/BV1kA411G7cK)

1. 简介:

   - **一个分布式系统如何就某个值达成一致**
   - 分布式数据系统的初始值相等且执行相等的操作系列, 最后也是一致的
   - 前提: 通信可靠不会被篡改

2. 角色介绍: `一个进程可以充当不同的角色`

   - proposer: 向集群提出议案 + 在发生冲突时调节
   - acceptor: 对提议者进行投票, 只有达到大多数时才会被最终接受
   - learner: 提议接受者, 对集群没有影响的单纯记录人员
   - proposal: proposer 提出的议案或者建议[编号为 n 和内容 value]
   - 最终的目标: 每个 proposer， acceptor, learner 都认为同一个 proposal 中的值被选中

3. 分类

   - basic paxos
   - multi-paxos

4. 缺点
   - 活锁
     1. proposer 的 proposal 被拒绝之后, 会采纳 acceptor 的更大编号进行提交
     2. 如果 两个 proposer 都发现自己自己编号低转而提出更大的 n 就会导致死循环
     3. 解决: 二进制指数退避算法[时间等待]
   - 效率低下: 完整流程需要两大轮返回请求 + `multi-paxos 先选举出leader之后每次就只需要一轮`
   - 实现困难: 共识算法的公有问题

### basic paxos

1. prepare 阶段
   - prepare(n) 请求: proposer 提出一个编号为 n(自己已知递增) 的议案, 向所有的 acceptor 广播, `只有编号`
   - promise(n, value) 返回: 如果 N 大于该 acceptor 此前接受的所有提案就接受`[返回空表示接收]`, 并承若不接受比 N 小的提议; 否则拒绝`[返回已经同意的最新的提案]`
2. accept 阶段

   - accept(n, value) 请求: proposer 收到多数派[多余一般的 acceptor 返回的 promise], 如果存在存在编号大的就跟新自己的 value, 否则返回此次提案的 value
   - accepted(n) 返回: 如果在此期间没有人格编号大于 n 的提案, 就接受提案内容; 否则拒绝
   - 当 proposer 收到超过半数的 acceptor 的返回值之后, 达成共识

   ![avatar](/static/image/common/mic-paxos.png)
