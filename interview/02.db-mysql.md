## 问题列表

1. mysql 表删除一半数据, B+树索引文件会不会变小

   - 结论: 对于千万级的表数据存储, 删除大量记录后, 表文件大小并没有随之变小
   - 记录复用: 删除 id=7 这条记录, InnoDB 引擎只是把 id=7 这条记录标记为删除,但是空间保留; 如果后面有 id 位于(6,19)区间内的数据插入时, 可以重复使用这个空间
   - 数据页复用: 当整个页从 B+树摘掉后, 可以复用到任何位置; 如果相邻两个 page 的利用率都很低, 数据库会将两个页的数据合并到其中一个 page 上, 另一个 page 被标记为可复用
   - `空洞`原因: 删除数据只会讲数据页或者记录空间标记为可复用, 但空间并没有释放, 所以表文件大小依然没有改变
   - 插入数据存在也分裂问题
   - 修改的是非索引值无影响, 如果修改的内容包含了索引, 那么操作步骤是先删除一个旧的值, 然后再插入一个新值
   - 解决数据空洞问题[重建表/索引] + 高并发下修改表结构[timeout]
